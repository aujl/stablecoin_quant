name: "Setup Poetry Environment"
description: "Install Python, Poetry, and project dependencies"
author: "stablecoin_quant maintainers"
inputs:
  python-version:
    description: "Python version to install"
    required: false
    default: "3.12"
  install-args:
    description: "Arguments passed to 'poetry install'"
    required: false
    default: "--with dev --no-interaction"
  cache-dependency-path:
    description: "Files considered for dependency caching"
    required: false
    default: |
      poetry.lock
      pyproject.toml
  working-directory:
    description: "Directory containing the Poetry project"
    required: false
    default: "."
runs:
  using: "composite"
  steps:
    - name: "Set up Python"
      id: setup-python
      uses: actions/setup-python@v5
      with:
        python-version: ${{ inputs.python-version }}

    - name: "Install Poetry"
      shell: bash
      run: |
        set -euo pipefail
        python -m pip install --upgrade pip
        python -m pip install "poetry==1.8.4"
        echo "${HOME}/.local/bin" >>"${GITHUB_PATH}"

    - name: "Configure Poetry"
      shell: bash
      run: |
        set -euo pipefail
        poetry --version
        poetry config virtualenvs.create true
        poetry config virtualenvs.in-project true
        poetry config installer.parallel true

    - name: "Install dependencies"
      working-directory: ${{ inputs.working-directory }}
      shell: bash
      run: |
        set -euo pipefail
        poetry install ${{ inputs.install-args }}
